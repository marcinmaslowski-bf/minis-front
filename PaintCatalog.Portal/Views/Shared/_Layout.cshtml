@using System.Globalization
@using PaintCatalog.Portal.Helpers
@inject Microsoft.Extensions.Localization.IStringLocalizer<PaintCatalog.Portal.Resources.SharedResource> L

@{
    // Source of truth: CurrentUICulture set by RequestLocalization middleware
    var uiLang = CultureHelpers.GetCurrentLangTwoLetter();
    var isPl = CultureHelpers.IsPl();
    var routeCulture = CultureHelpers.GetRouteCultureSegment();

    // canonical path is already normalized (no trailing slash) by middleware
    var path = Context.Request.Path.HasValue ? Context.Request.Path.Value : "/";
    var host = $"{Context.Request.Scheme}://{Context.Request.Host}";
    var canonicalUrl = host + path;
}

<!DOCTYPE html>
<html lang="@uiLang" class="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>@ViewData["Title"]</title>
    <meta name="description" content="@L["Home_Hero_Description"]" />

    <!-- Canonical -->
    <link rel="canonical" href="@canonicalUrl" />

    <!-- Hreflang -->
    <link rel="alternate" href="@($"{host}/")" hreflang="en" />
    <link rel="alternate" href="@($"{host}/pl")" hreflang="pl" />
    <link rel="alternate" href="@canonicalUrl" hreflang="x-default" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        };
    </script>

    <script>
        // Initialize dark/light mode from localStorage or prefers-color-scheme
        (function () {
            const stored = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (stored === 'dark' || (!stored && prefersDark)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        })();

        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
    </script>
</head>
<body class="bg-slate-950 text-slate-50">
    <header class="sticky top-0 z-20 border-b border-slate-800 bg-slate-950/80 backdrop-blur">
        <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3">
            <a asp-controller="Home" asp-action="Index" asp-route-culture="@routeCulture"
               class="flex items-center gap-2">
                <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-emerald-500 text-sm font-bold">PC</span>
                <span class="text-sm font-semibold tracking-tight md:text-base">
                    @L["SiteTitle"]
                </span>
            </a>

            <nav class="hidden items-center gap-6 text-sm text-slate-300 md:flex">
                <a asp-controller="Home" asp-action="Index" asp-route-culture="@routeCulture"
                   class="hover:text-emerald-300">Home</a>
            </nav>

            <div class="flex items-center gap-3 text-xs">
                <button onclick="toggleTheme()"
                        class="rounded-full border border-slate-700 px-3 py-1 text-slate-200 hover:border-emerald-500">
                    Dark / Light
                </button>

                <div class="flex gap-1 rounded-full border border-slate-700 bg-slate-900/80 p-1">
                    <a asp-controller="Home" asp-action="Index" asp-route-culture=""
                       class="px-2 py-0.5 rounded-full @(isPl ? "text-slate-300" : "bg-emerald-500 text-slate-950")">
                        EN
                    </a>
                    <a asp-controller="Home" asp-action="Index" asp-route-culture="pl"
                       class="px-2 py-0.5 rounded-full @(isPl ? "bg-emerald-500 text-slate-950" : "text-slate-300")">
                        PL
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="mx-auto max-w-6xl px-4 py-8">
        @RenderBody()
    </main>

    <footer class="border-t border-slate-800 bg-slate-950/90">
        <div class="mx-auto flex max-w-6xl flex-col justify-between gap-3 px-4 py-4 text-xs text-slate-500 md:flex-row">
            <p>Â© @DateTime.UtcNow.Year Paint Catalog Portal</p>
            <div class="flex flex-wrap gap-3">
                <a href="#" class="hover:text-emerald-300">About</a>
                <a href="#" class="hover:text-emerald-300">Contact</a>
            </div>
        </div>
    </footer>

    @RenderSection("Scripts", required: false)
</body>
</html>
