@model PaintCatalog.Portal.Models.Bookmarks.BookmarkTabsViewModel
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer

@{
    var prefix = string.IsNullOrWhiteSpace(Model.Prefix) ? "bookmark" : Model.Prefix!;
    var jsonOptions = new System.Text.Json.JsonSerializerOptions
    {
        PropertyNamingPolicy = System.Text.Json.JsonNamingPolicy.CamelCase,
        WriteIndented = false
    };

    var bootstrap = new
    {
        endpoints = new
        {
            list = Model.BookmarksEndpoint ?? "/bookmarks/list",
            categories = Url.Action("Categories", "Bookmarks") ?? "/bookmarks/categories",
            createCategory = Url.Action("CreateCategory", "Bookmarks") ?? "/bookmarks/categories",
            upsert = Url.Action("Upsert", "Bookmarks") ?? "/bookmarks",
            delete = Url.Action("Delete", "Bookmarks", new { itemType = "__type__", itemId = "__id__" }) ?? "/bookmarks/__type__/__id__"
        },
        labels = new
        {
            heading = Localizer["Heading"].Value,
            subheading = Localizer["Subheading"].Value,
            refresh = Localizer["Refresh_Button"].Value,
            filterLabel = Localizer["Filter_Label"].Value,
            filterAllPaints = Localizer["Filter_All_Paints"].Value,
            filterAllTutorials = Localizer["Filter_All_Tutorials"].Value,
            tabPaints = Localizer["Tab_Paints"].Value,
            tabTutorials = Localizer["Tab_Tutorials"].Value,
            emptyPaintsTitle = Localizer["Empty_Paints_Title"].Value,
            emptyPaintsDescription = Localizer["Empty_Paints_Description"].Value,
            emptyTutorialsTitle = Localizer["Empty_Tutorials_Title"].Value,
            emptyTutorialsDescription = Localizer["Empty_Tutorials_Description"].Value,
            errorLoad = Localizer["Error_Load"].Value,
            errorSave = Localizer["Error_Save"].Value,
            errorDelete = Localizer["Error_Delete"].Value,
            noteLabel = Localizer["Note_Label"].Value,
            typePaint = Localizer["Type_Paint"].Value,
            typeTutorial = Localizer["Type_Tutorial"].Value,
            typeUnknown = Localizer["Type_Unknown"].Value,
            open = Localizer["Open_Link"].Value,
            edit = Localizer["Edit"].Value,
            delete = Localizer["Delete"].Value,
            modalTitlePaint = Localizer["Modal_Title_Paint"].Value,
            modalTitleTutorial = Localizer["Modal_Title_Tutorial"].Value,
            categoryLabel = Localizer["Bookmark_Category_Label"].Value,
            newCategoryLabel = Localizer["Bookmark_NewCategory_Label"].Value,
            newCategoryPlaceholder = Localizer["Bookmark_NewCategory_Placeholder"].Value,
            addCategory = Localizer["Bookmark_AddCategory_Button"].Value,
            notePlaceholder = Localizer["Bookmark_Note_Placeholder"].Value,
            save = Localizer["Bookmark_Save"].Value,
            cancel = Localizer["Bookmark_Cancel"].Value,
            remove = Localizer["Bookmark_Remove"].Value,
            statusLoaded = Localizer["Status_Loaded"].Value,
            statusSaved = Localizer["Status_Saved"].Value,
            statusDeleted = Localizer["Status_Deleted"].Value,
            confirmDelete = Localizer["Confirm_Delete"].Value,
            refreshLoading = Localizer["Status_Loading"].Value
        }
    };

    var bootstrapJson = System.Text.Json.JsonSerializer.Serialize(bootstrap, jsonOptions);
}

<div class="space-y-4 rounded-2xl bg-white/80 p-4 shadow-sm dark:bg-slate-900/70"
     data-bookmark-root
     data-bookmark-prefix="@prefix">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
        <div class="inline-flex w-full max-w-xl rounded-xl border border-slate-200 bg-slate-50 p-1 text-sm font-semibold text-slate-600 shadow-inner dark:border-slate-700 dark:bg-slate-800/70 dark:text-slate-200" role="tablist">
            <button data-bookmark-tab="paint" class="bookmark-tab-btn flex-1 rounded-lg px-3 py-2 transition" role="tab" aria-selected="true">@Localizer["Tab_Paints"]</button>
            <button data-bookmark-tab="tutorial" class="bookmark-tab-btn flex-1 rounded-lg px-3 py-2 transition" role="tab" aria-selected="false">@Localizer["Tab_Tutorials"]</button>
        </div>

        @if (Model.ShowRefreshButton)
        {
            <button id="@($"{prefix}-refresh")" type="button" class="inline-flex items-center gap-2 rounded-xl border border-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-700 transition hover:bg-emerald-500 hover:text-white focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:border-emerald-400 dark:text-emerald-200 dark:hover:bg-emerald-400 dark:hover:text-slate-900">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992V4.356" /><path stroke-linecap="round" stroke-linejoin="round" d="M2.985 19.644v-4.992h4.992" /><path stroke-linecap="round" stroke-linejoin="round" d="M20.268 13.65a8.25 8.25 0 0 1-13.803 4.8L2.985 14.65" /><path stroke-linecap="round" stroke-linejoin="round" d="M3.732 10.35a8.25 8.25 0 0 1 13.803-4.8l3.48 3.8" /></svg>
                <span>@Localizer["Refresh_Button"]</span>
            </button>
        }
    </div>

    <div id="@($"{prefix}-status")" class="hidden text-sm font-semibold text-emerald-600 dark:text-emerald-300"></div>
    <div id="@($"{prefix}-error")" class="hidden text-sm font-semibold text-rose-600 dark:text-rose-300"></div>

    <div data-bookmark-panel="paint" class="space-y-4" role="tabpanel">
        <div class="flex flex-col gap-2">
            <label for="@($"{prefix}-filter-paint")" class="text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">@Localizer["Filter_Label"]</label>
            <select id="@($"{prefix}-filter-paint")" class="w-full rounded-xl border border-slate-300 bg-white/90 p-2 text-sm text-slate-900 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/40 dark:border-slate-700 dark:bg-slate-950/50 dark:text-slate-100 sm:w-80"></select>
        </div>

        <div id="@($"{prefix}-empty-paint")" class="hidden rounded-2xl border border-dashed border-slate-300 bg-white/60 p-6 text-center text-slate-600 dark:border-slate-700 dark:bg-slate-900/50 dark:text-slate-300">
            <h2 class="text-lg font-semibold">@Localizer["Empty_Paints_Title"]</h2>
            <p class="mt-1 text-sm">@Localizer["Empty_Paints_Description"]</p>
        </div>

        <div id="@($"{prefix}-list-paint")" class="grid grid-cols-1 gap-4 sm:grid-cols-2"></div>
    </div>

    <div data-bookmark-panel="tutorial" class="space-y-4 hidden" role="tabpanel">
        <div class="flex flex-col gap-2">
            <label for="@($"{prefix}-filter-tutorial")" class="text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">@Localizer["Filter_Label"]</label>
            <select id="@($"{prefix}-filter-tutorial")" class="w-full rounded-xl border border-slate-300 bg-white/90 p-2 text-sm text-slate-900 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/40 dark:border-slate-700 dark:bg-slate-950/50 dark:text-slate-100 sm:w-80"></select>
        </div>

        <div id="@($"{prefix}-empty-tutorial")" class="hidden rounded-2xl border border-dashed border-slate-300 bg-white/60 p-6 text-center text-slate-600 dark:border-slate-700 dark:bg-slate-900/50 dark:text-slate-300">
            <h2 class="text-lg font-semibold">@Localizer["Empty_Tutorials_Title"]</h2>
            <p class="mt-1 text-sm">@Localizer["Empty_Tutorials_Description"]</p>
        </div>

        <div id="@($"{prefix}-list-tutorial")" class="grid grid-cols-1 gap-4 sm:grid-cols-2"></div>
    </div>
</div>

<div id="@($"{prefix}-edit-modal")" class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-900/40 p-4">
    <div class="w-full max-w-xl rounded-2xl border border-slate-200 bg-white p-6 shadow-xl dark:border-slate-700 dark:bg-slate-900" role="dialog" aria-modal="true">
        <div class="flex items-start justify-between gap-4">
            <div>
                <p id="@($"{prefix}-modal-type")" class="text-xs font-semibold uppercase tracking-wide text-emerald-500"></p>
                <h2 id="@($"{prefix}-modal-title")" class="text-xl font-semibold text-slate-900 dark:text-white"></h2>
            </div>
            <button id="@($"{prefix}-edit-close")" type="button" class="rounded-full p-2 text-slate-500 transition hover:bg-slate-100 hover:text-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-200 dark:text-slate-300 dark:hover:bg-slate-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg>
            </button>
        </div>

        <div class="mt-4 space-y-4 text-sm text-slate-700 dark:text-slate-200">
            <div class="space-y-2">
                <label for="@($"{prefix}-edit-category")" class="text-sm font-semibold text-slate-700 dark:text-slate-200">@Localizer["Bookmark_Category_Label"]</label>
                <select id="@($"{prefix}-edit-category")" class="w-full rounded-xl border border-slate-300 bg-white/90 p-3 text-sm text-slate-900 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/40 dark:border-slate-700 dark:bg-slate-950/50 dark:text-slate-100"></select>
            </div>

            <div class="grid gap-3 sm:grid-cols-[1fr_auto] sm:items-end">
                <div class="space-y-2">
                    <label for="@($"{prefix}-edit-new-category")" class="text-sm font-semibold text-slate-700 dark:text-slate-200">@Localizer["Bookmark_NewCategory_Label"]</label>
                    <input id="@($"{prefix}-edit-new-category")" type="text" maxlength="80" placeholder="@Localizer["Bookmark_NewCategory_Placeholder"]" class="w-full rounded-xl border border-slate-300 bg-white/90 p-3 text-sm text-slate-900 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/40 dark:border-slate-700 dark:bg-slate-950/50 dark:text-slate-100" />
                </div>
                <button id="@($"{prefix}-edit-add-category")" type="button" class="inline-flex items-center justify-center rounded-xl border border-slate-300 px-4 py-3 text-sm font-semibold text-slate-700 transition hover:border-emerald-500 hover:text-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:border-slate-700 dark:text-slate-200 dark:hover:border-emerald-400 dark:hover:text-emerald-300">@Localizer["Bookmark_AddCategory_Button"]</button>
            </div>

            <div class="space-y-2">
                <label for="@($"{prefix}-edit-note")" class="text-sm font-semibold text-slate-700 dark:text-slate-200">@Localizer["Bookmark_Note_Label"]</label>
                <textarea id="@($"{prefix}-edit-note")" rows="3" placeholder="@Localizer["Bookmark_Note_Placeholder"]" class="w-full rounded-xl border border-slate-300 bg-white/80 p-3 text-sm text-slate-900 placeholder:text-slate-400 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/40 dark:border-slate-700 dark:bg-slate-950/40 dark:text-slate-100"></textarea>
            </div>

            <div id="@($"{prefix}-edit-status")" class="hidden text-sm font-semibold text-emerald-600 dark:text-emerald-300"></div>
            <div id="@($"{prefix}-edit-error")" class="hidden text-sm font-semibold text-rose-600 dark:text-rose-300"></div>
        </div>

        <div class="mt-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
            <div class="flex gap-3">
                <button id="@($"{prefix}-edit-delete")" type="button" class="inline-flex items-center gap-2 rounded-xl border border-slate-300 px-4 py-2 text-sm font-semibold text-rose-600 transition hover:border-rose-400 hover:text-rose-700 focus:outline-none focus:ring-2 focus:ring-rose-300 dark:border-slate-700 dark:text-rose-300 dark:hover:border-rose-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673A2.25 2.25 0 0 1 15.916 21.75H8.084a2.25 2.25 0 0 1-2.245-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>
                    @Localizer["Bookmark_Remove"]
                </button>
                <button id="@($"{prefix}-edit-cancel")" type="button" class="inline-flex items-center gap-2 rounded-xl border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:border-slate-700 dark:text-slate-200 dark:hover:border-slate-500">@Localizer["Bookmark_Cancel"]</button>
            </div>
            <button id="@($"{prefix}-edit-save")" type="button" class="inline-flex items-center gap-2 rounded-xl bg-emerald-600 px-5 py-2 text-sm font-semibold text-white transition hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>
                @Localizer["Bookmark_Save"]
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        window.bookmarkListPrefix = '@prefix';
        window.bookmarkListBootstrap = @Html.Raw(bootstrapJson);
    </script>
    <script src="~/js/paint-swatch.js"></script>
    <script src="~/js/bookmark-list.js"></script>
}
